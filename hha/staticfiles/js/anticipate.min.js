function anticipate(start_date, end_date) {
    const currentTime = new Date();
    const countToDate = new Date(start_date);
    var endTime = new Date(end_date);

    var timezoneOffset = new Date().getTimezoneOffset();
    var offsetForLagos = -60 * 60 * 1000;
    endTime = new Date(endTime.getTime() + (timezoneOffset + offsetForLagos));

    if (currentTime >= endTime) {
        document.querySelector('.countdown-container').innerHTML = "<strong>Anticipate</strong>Event has already taken place!";
    } else {
        flipAllCards(countToDate);
    }
}


function flipAllCards(targetDate) {
    var targetDateTime = new Date(targetDate);

    var timezoneOffset = new Date().getTimezoneOffset();
    var offsetForLagos = -60 * 60 * 1000;
    targetDateTime = new Date(targetDateTime.getTime() + (timezoneOffset + offsetForLagos));

    var timerId = countdown(
        targetDateTime,
        function(ts) {
            if (ts.value > 0) {
                clearInterval(timerId);
                document.querySelector('.countdown-container').innerHTML = "<strong>Anticipate</strong>Event is in progress!";
            }
            Count('years', ts.years);
            Count('months', ts.months);
            Count('weeks', ts.weeks);
            Count('days', ts.days);
            Count('hours', ts.hours);
            Count('minutes', ts.minutes);
            Count('seconds', ts.seconds);
        },
        countdown.YEARS | countdown.MONTHS | countdown.WEEKS | countdown.DAYS | countdown.HOURS | countdown.MINUTES | countdown.SECONDS
    );
}

function Count(elementId, value) {
    flip(document.querySelector(`[data-${elementId}-tens]`), Math.floor(value / 10));
    flip(document.querySelector(`[data-${elementId}-ones]`), value % 10);
    const displayElement = document.querySelector(`.container-segment.${elementId}`);
    if (elementId !== 'seconds' && elementId !== 'minutes' && elementId !== 'hours') { displayElement.style.display = value === 0 ? 'none' : ''; }
    const textElement = document.querySelector(`[${elementId}]`);
    textElement.textContent = value === 1 ? titleCase(elementId).slice(0, -1) : titleCase(elementId);
}

function titleCase(str) { return str.toLowerCase().split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '); }

function flip(flipCard, newNumber) {
    const topHalf = flipCard.querySelector(".top");
    const startNumber = parseInt(topHalf.textContent);
    if (newNumber === startNumber) return;
    const bottomHalf = flipCard.querySelector(".bottom");
    const topFlip = document.createElement("div");
    topFlip.classList.add("top-flip");
    const bottomFlip = document.createElement("div");
    bottomFlip.classList.add("bottom-flip");
    topHalf.textContent = startNumber;
    bottomHalf.textContent = startNumber;
    topFlip.textContent = startNumber;
    bottomFlip.textContent = newNumber;
    topFlip.addEventListener("animationstart", e => { topHalf.textContent = newNumber; });
    topFlip.addEventListener("animationend", e => { topFlip.remove(); });
    bottomFlip.addEventListener("animationend", e => {
        bottomHalf.textContent = newNumber;
        bottomFlip.remove();
    });
    flipCard.append(topFlip, bottomFlip);
}
